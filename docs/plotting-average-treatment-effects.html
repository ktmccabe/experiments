<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.1 Plotting Average Treatment Effects | Experimental Methods in Political Science</title>
  <meta name="description" content="5.1 Plotting Average Treatment Effects | Experimental Methods in Political Science" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="5.1 Plotting Average Treatment Effects | Experimental Methods in Political Science" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.1 Plotting Average Treatment Effects | Experimental Methods in Political Science" />
  
  
  

<meta name="author" content="Instructor: Katie McCabe" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualize.html"/>
<link rel="next" href="heterogeneous-treatment-effects-1.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.4/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Course Notes</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rsetup.html"><a href="rsetup.html"><i class="fa fa-check"></i><b>1.1</b> Setup in R</a></li>
<li class="chapter" data-level="1.2" data-path="first-time-working-in-r-and-rstudio.html"><a href="first-time-working-in-r-and-rstudio.html"><i class="fa fa-check"></i><b>1.2</b> First Time Working in R and RStudio</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="first-time-working-in-r-and-rstudio.html"><a href="first-time-working-in-r-and-rstudio.html#open-rstudio"><i class="fa fa-check"></i><b>1.2.1</b> Open RStudio</a></li>
<li class="chapter" data-level="1.2.2" data-path="first-time-working-in-r-and-rstudio.html"><a href="first-time-working-in-r-and-rstudio.html#using-r-as-a-calculator"><i class="fa fa-check"></i><b>1.2.2</b> Using R as a Calculator</a></li>
<li class="chapter" data-level="1.2.3" data-path="first-time-working-in-r-and-rstudio.html"><a href="first-time-working-in-r-and-rstudio.html#working-in-an-r-script"><i class="fa fa-check"></i><b>1.2.3</b> Working in an R Script</a></li>
<li class="chapter" data-level="1.2.4" data-path="first-time-working-in-r-and-rstudio.html"><a href="first-time-working-in-r-and-rstudio.html#preparing-your-r-script"><i class="fa fa-check"></i><b>1.2.4</b> Preparing your R script</a></li>
<li class="chapter" data-level="1.2.5" data-path="first-time-working-in-r-and-rstudio.html"><a href="first-time-working-in-r-and-rstudio.html#executing-commands-in-your-r-script"><i class="fa fa-check"></i><b>1.2.5</b> Executing Commands in your R script</a></li>
<li class="chapter" data-level="1.2.6" data-path="first-time-working-in-r-and-rstudio.html"><a href="first-time-working-in-r-and-rstudio.html#objects"><i class="fa fa-check"></i><b>1.2.6</b> Objects</a></li>
<li class="chapter" data-level="1.2.7" data-path="first-time-working-in-r-and-rstudio.html"><a href="first-time-working-in-r-and-rstudio.html#practice-with-r-scripts"><i class="fa fa-check"></i><b>1.2.7</b> Practice with R Scripts</a></li>
<li class="chapter" data-level="1.2.8" data-path="first-time-working-in-r-and-rstudio.html"><a href="first-time-working-in-r-and-rstudio.html#loading-data-into-r"><i class="fa fa-check"></i><b>1.2.8</b> Loading data into R</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>1.3</b> R Markdown</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="r-markdown.html"><a href="r-markdown.html#how-to-get-setup-in-rmarkdown"><i class="fa fa-check"></i><b>1.3.1</b> How to get setup in RMarkdown</a></li>
<li class="chapter" data-level="1.3.2" data-path="r-markdown.html"><a href="r-markdown.html#additional-rmarkdown-resources"><i class="fa fa-check"></i><b>1.3.2</b> Additional RMarkdown resources</a></li>
<li class="chapter" data-level="1.3.3" data-path="r-markdown.html"><a href="r-markdown.html#practice-with-r-markdown"><i class="fa fa-check"></i><b>1.3.3</b> Practice with R Markdown</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="what-are-experiments.html"><a href="what-are-experiments.html"><i class="fa fa-check"></i><b>1.4</b> What are experiments?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="causaleffects.html"><a href="causaleffects.html"><i class="fa fa-check"></i><b>2</b> Causal Effects</a>
<ul>
<li class="chapter" data-level="2.1" data-path="potential-outcomes-framework.html"><a href="potential-outcomes-framework.html"><i class="fa fa-check"></i><b>2.1</b> Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="potential-outcomes-framework.html"><a href="potential-outcomes-framework.html#average-treatment-effect"><i class="fa fa-check"></i><b>2.1.1</b> Average Treatment Effect</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="fundamental-problem-of-causal-inference.html"><a href="fundamental-problem-of-causal-inference.html"><i class="fa fa-check"></i><b>2.2</b> Fundamental Problem of Causal Inference</a></li>
<li class="chapter" data-level="2.3" data-path="identification-strategy.html"><a href="identification-strategy.html"><i class="fa fa-check"></i><b>2.3</b> Identification strategy</a></li>
<li class="chapter" data-level="2.4" data-path="difference-in-means-estimator.html"><a href="difference-in-means-estimator.html"><i class="fa fa-check"></i><b>2.4</b> Difference in Means Estimator</a></li>
<li class="chapter" data-level="2.5" data-path="overview-of-identification-assumptions.html"><a href="overview-of-identification-assumptions.html"><i class="fa fa-check"></i><b>2.5</b> Overview of identification assumptions</a></li>
<li class="chapter" data-level="2.6" data-path="application-in-r.html"><a href="application-in-r.html"><i class="fa fa-check"></i><b>2.6</b> Application in R</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="application-in-r.html"><a href="application-in-r.html#loading-the-data"><i class="fa fa-check"></i><b>2.6.1</b> Loading the data</a></li>
<li class="chapter" data-level="2.6.2" data-path="application-in-r.html"><a href="application-in-r.html#variable-classes"><i class="fa fa-check"></i><b>2.6.2</b> Variable classes</a></li>
<li class="chapter" data-level="2.6.3" data-path="application-in-r.html"><a href="application-in-r.html#exploring-treatment-and-control-groups"><i class="fa fa-check"></i><b>2.6.3</b> Exploring Treatment and Control Groups</a></li>
<li class="chapter" data-level="2.6.4" data-path="application-in-r.html"><a href="application-in-r.html#means-with-relational-operators"><i class="fa fa-check"></i><b>2.6.4</b> Means with Relational Operators</a></li>
<li class="chapter" data-level="2.6.5" data-path="application-in-r.html"><a href="application-in-r.html#means-with-tidyverse"><i class="fa fa-check"></i><b>2.6.5</b> Means with <code>tidyverse</code></a></li>
<li class="chapter" data-level="2.6.6" data-path="application-in-r.html"><a href="application-in-r.html#ate-with-linear-regression"><i class="fa fa-check"></i><b>2.6.6</b> ATE with linear regression</a></li>
<li class="chapter" data-level="2.6.7" data-path="application-in-r.html"><a href="application-in-r.html#subsetting-data-in-r"><i class="fa fa-check"></i><b>2.6.7</b> Subsetting data in R</a></li>
<li class="chapter" data-level="2.6.8" data-path="application-in-r.html"><a href="application-in-r.html#additional-practice"><i class="fa fa-check"></i><b>2.6.8</b> Additional Practice</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="design.html"><a href="design.html"><i class="fa fa-check"></i><b>3</b> Experimental Design</a>
<ul>
<li class="chapter" data-level="3.1" data-path="designing-an-experiment.html"><a href="designing-an-experiment.html"><i class="fa fa-check"></i><b>3.1</b> Designing an Experiment</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="designing-an-experiment.html"><a href="designing-an-experiment.html#validity"><i class="fa fa-check"></i><b>3.1.1</b> Validity</a></li>
<li class="chapter" data-level="3.1.2" data-path="designing-an-experiment.html"><a href="designing-an-experiment.html#design-space-for-experiments"><i class="fa fa-check"></i><b>3.1.2</b> Design Space for Experiments</a></li>
<li class="chapter" data-level="3.1.3" data-path="designing-an-experiment.html"><a href="designing-an-experiment.html#types-of-designs"><i class="fa fa-check"></i><b>3.1.3</b> Types of Designs</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="using-qualtrics.html"><a href="using-qualtrics.html"><i class="fa fa-check"></i><b>3.2</b> Using Qualtrics</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="using-qualtrics.html"><a href="using-qualtrics.html#experimental-design-with-vignette-experiment"><i class="fa fa-check"></i><b>3.2.1</b> Experimental Design with Vignette Experiment</a></li>
<li class="chapter" data-level="3.2.2" data-path="using-qualtrics.html"><a href="using-qualtrics.html#unique-blocks-per-experimental-condition"><i class="fa fa-check"></i><b>3.2.2</b> Unique blocks per experimental condition</a></li>
<li class="chapter" data-level="3.2.3" data-path="using-qualtrics.html"><a href="using-qualtrics.html#adding-a-randomizer-in-the-survey-flow"><i class="fa fa-check"></i><b>3.2.3</b> Adding a randomizer in the survey flow</a></li>
<li class="chapter" data-level="3.2.4" data-path="using-qualtrics.html"><a href="using-qualtrics.html#using-piped-text-in-randomization"><i class="fa fa-check"></i><b>3.2.4</b> Using Piped Text in Randomization</a></li>
<li class="chapter" data-level="3.2.5" data-path="using-qualtrics.html"><a href="using-qualtrics.html#data-and-analysis"><i class="fa fa-check"></i><b>3.2.5</b> Data and Analysis</a></li>
<li class="chapter" data-level="3.2.6" data-path="using-qualtrics.html"><a href="using-qualtrics.html#additional-bells-and-whistles"><i class="fa fa-check"></i><b>3.2.6</b> Additional Bells and Whistles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="uncertainty.html"><a href="uncertainty.html"><i class="fa fa-check"></i><b>4</b> Uncertainty</a>
<ul>
<li class="chapter" data-level="4.1" data-path="standard-errors.html"><a href="standard-errors.html"><i class="fa fa-check"></i><b>4.1</b> Standard Errors</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="standard-errors.html"><a href="standard-errors.html#standard-error-of-the-mean"><i class="fa fa-check"></i><b>4.1.1</b> Standard Error of the Mean</a></li>
<li class="chapter" data-level="4.1.2" data-path="standard-errors.html"><a href="standard-errors.html#standard-error-for-a-difference-in-means"><i class="fa fa-check"></i><b>4.1.2</b> Standard error for a difference in means</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="confidence-intervals.html"><a href="confidence-intervals.html"><i class="fa fa-check"></i><b>4.2</b> Confidence Intervals</a></li>
<li class="chapter" data-level="4.3" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html"><i class="fa fa-check"></i><b>4.3</b> Hypothesis Tests</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html#t-tests"><i class="fa fa-check"></i><b>4.3.1</b> t-tests</a></li>
<li class="chapter" data-level="4.3.2" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html#p-values"><i class="fa fa-check"></i><b>4.3.2</b> p-values</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="empirical-application.html"><a href="empirical-application.html"><i class="fa fa-check"></i><b>4.4</b> Empirical Application</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="empirical-application.html"><a href="empirical-application.html#treatment"><i class="fa fa-check"></i><b>4.4.1</b> Treatment</a></li>
<li class="chapter" data-level="4.4.2" data-path="empirical-application.html"><a href="empirical-application.html#analysis"><i class="fa fa-check"></i><b>4.4.2</b> Analysis</a></li>
<li class="chapter" data-level="4.4.3" data-path="empirical-application.html"><a href="empirical-application.html#heterogeneous-treatment-effects"><i class="fa fa-check"></i><b>4.4.3</b> Heterogeneous Treatment Effects</a></li>
<li class="chapter" data-level="4.4.4" data-path="empirical-application.html"><a href="empirical-application.html#difference-in-proportions"><i class="fa fa-check"></i><b>4.4.4</b> Difference in Proportions</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="randomization-inference.html"><a href="randomization-inference.html"><i class="fa fa-check"></i><b>4.5</b> Randomization Inference</a></li>
<li class="chapter" data-level="4.6" data-path="a-note-on-expectations-and-variance.html"><a href="a-note-on-expectations-and-variance.html"><i class="fa fa-check"></i><b>4.6</b> A Note on Expectations and Variance</a></li>
<li class="chapter" data-level="4.7" data-path="equivalence-of-t-test-and-anova.html"><a href="equivalence-of-t-test-and-anova.html"><i class="fa fa-check"></i><b>4.7</b> Equivalence of t-test and ANOVA</a></li>
<li class="chapter" data-level="4.8" data-path="experimental-design-complications.html"><a href="experimental-design-complications.html"><i class="fa fa-check"></i><b>4.8</b> Experimental Design Complications</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="visualize.html"><a href="visualize.html"><i class="fa fa-check"></i><b>5</b> Visualization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="plotting-average-treatment-effects.html"><a href="plotting-average-treatment-effects.html"><i class="fa fa-check"></i><b>5.1</b> Plotting Average Treatment Effects</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="plotting-average-treatment-effects.html"><a href="plotting-average-treatment-effects.html#ate-using-plot"><i class="fa fa-check"></i><b>5.1.1</b> ATE using <code>plot</code></a></li>
<li class="chapter" data-level="5.1.2" data-path="plotting-average-treatment-effects.html"><a href="plotting-average-treatment-effects.html#ate-with-ggplot"><i class="fa fa-check"></i><b>5.1.2</b> ATE with <code>ggplot</code></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="heterogeneous-treatment-effects-1.html"><a href="heterogeneous-treatment-effects-1.html"><i class="fa fa-check"></i><b>5.2</b> Heterogeneous Treatment Effects</a></li>
<li class="chapter" data-level="5.3" data-path="some-additional-plotting-options.html"><a href="some-additional-plotting-options.html"><i class="fa fa-check"></i><b>5.3</b> Some additional plotting options</a></li>
<li class="chapter" data-level="5.4" data-path="examples-of-arguments-in-plot.html"><a href="examples-of-arguments-in-plot.html"><i class="fa fa-check"></i><b>5.4</b> Examples of arguments in <code>plot</code></a></li>
<li class="chapter" data-level="5.5" data-path="creating-tables-from-r.html"><a href="creating-tables-from-r.html"><i class="fa fa-check"></i><b>5.5</b> Creating Tables from R</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="creating-tables-from-r.html"><a href="creating-tables-from-r.html#additional-formatting-examples"><i class="fa fa-check"></i><b>5.5.1</b> Additional formatting examples</a></li>
<li class="chapter" data-level="5.5.2" data-path="creating-tables-from-r.html"><a href="creating-tables-from-r.html#additional-table-types"><i class="fa fa-check"></i><b>5.5.2</b> Additional Table Types</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ethics.html"><a href="ethics.html"><i class="fa fa-check"></i><b>6</b> Ethics and Sampling Considerations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="value-of-informed-consent.html"><a href="value-of-informed-consent.html"><i class="fa fa-check"></i><b>6.1</b> Value of Informed Consent</a></li>
<li class="chapter" data-level="6.2" data-path="research-fraud.html"><a href="research-fraud.html"><i class="fa fa-check"></i><b>6.2</b> Research Fraud</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Experimental Methods in Political Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="plotting-average-treatment-effects" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Plotting Average Treatment Effects</h2>
<p>The example we will use is from <a href="https://link.springer.com/article/10.1007/s11109-018-9477-1">“Black Politics: How Anger Infuences the Political Actions
Blacks Pursue to Reduce Racial Inequality”</a> by Antoine J. Banks, Ismail K. White, and Brian D. McKenzie, published in <em>Political Behavior</em> in 2019.</p>
<p>We will replicate the results from Study 2, which is a survey experiment. The sample includes 444 Black treated Black respondents recruited by Qualtrics. The excerpt below shows the experimental manipulation.</p>
<p><img src="images/bankstreat.png" style="width:70.0%" /></p>
<p>Here is a short video walking through the code to plot the ATEs using <code>plot</code> and <code>ggplot</code>. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</p>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/_RniJm-hmHE" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>Let’s load the data. Note: This file is in a .dta format, but if you try to use <code>read.dta</code> to load it, you may receive an error because it is too new of a Stata format. As an alternative, we can use the <code>rio</code> package to open the file. Install the package, open the package with <code>library</code> an load the data. The <code>rio</code> packages uses a single <code>import</code> function to load data.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="plotting-average-treatment-effects.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages(&quot;rio&quot;, dependencies=T)</span></span>
<span id="cb167-2"><a href="plotting-average-treatment-effects.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb167-3"><a href="plotting-average-treatment-effects.html#cb167-3" aria-hidden="true" tabindex="-1"></a>banks <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;data/banksstudy2.dta&quot;</span>)</span></code></pre></div>
<p>The authors have a variable in their data <code>baddata</code> they use to exclude subjects who failed to follow the instructions of their manipulation. They limit their analyses to those who passed this check. Let’s do the same by removing any subjects that have non-missing values on this variable.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="plotting-average-treatment-effects.html#cb168-1" aria-hidden="true" tabindex="-1"></a>banks <span class="ot">&lt;-</span> <span class="fu">subset</span>(banks, <span class="fu">is.na</span>(baddata)<span class="sc">==</span>T)</span></code></pre></div>
<p>Let’s replicate a portion of the analysis presented in Table 3 of the paper.</p>
<p><img src="images/bankstable3.png" style="width:80.0%" /></p>
<p>We will first calculate our estimate of <span class="math inline">\(E(Y_i(1_{anger}) - Y_i(0_{no anger}))\)</span> using the difference-in-means estimator: <span class="math inline">\(\sum_{i=1}^m Y_i(1_{anger}) - \sum_{m+1}^{N-m}Y_i(0_{no anger})\)</span>.</p>
<ul>
<li>We will compare those in the Anger and Control conditions on the outcome for donations to Black organizations.</li>
<li>We will use a t-test to do so.</li>
</ul>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="plotting-average-treatment-effects.html#cb169-1" aria-hidden="true" tabindex="-1"></a>d.i.m <span class="ot">&lt;-</span> <span class="fu">mean</span>(banks<span class="sc">$</span>blackdon[banks<span class="sc">$</span>angvcon <span class="sc">==</span> <span class="dv">1</span>], <span class="at">na.rm=</span>T) <span class="sc">-</span></span>
<span id="cb169-2"><a href="plotting-average-treatment-effects.html#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(banks<span class="sc">$</span>blackdon[banks<span class="sc">$</span>angvcon <span class="sc">==</span> <span class="dv">0</span>], <span class="at">na.rm=</span>T)</span>
<span id="cb169-3"><a href="plotting-average-treatment-effects.html#cb169-3" aria-hidden="true" tabindex="-1"></a>t.results <span class="ot">&lt;-</span> <span class="fu">t.test</span>(banks<span class="sc">$</span>blackdon[banks<span class="sc">$</span>angvcon <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb169-4"><a href="plotting-average-treatment-effects.html#cb169-4" aria-hidden="true" tabindex="-1"></a>                    banks<span class="sc">$</span>blackdon[banks<span class="sc">$</span>angvcon <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb169-5"><a href="plotting-average-treatment-effects.html#cb169-5" aria-hidden="true" tabindex="-1"></a>ci <span class="ot">&lt;-</span> t.results<span class="sc">$</span>conf.int</span></code></pre></div>
<p>Let’s repeat for the hope condition.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="plotting-average-treatment-effects.html#cb170-1" aria-hidden="true" tabindex="-1"></a>d.i.m2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(banks<span class="sc">$</span>blackdon[banks<span class="sc">$</span>hopevcon <span class="sc">==</span> <span class="dv">1</span>], <span class="at">na.rm=</span>T) <span class="sc">-</span></span>
<span id="cb170-2"><a href="plotting-average-treatment-effects.html#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(banks<span class="sc">$</span>blackdon[banks<span class="sc">$</span>hopevcon <span class="sc">==</span> <span class="dv">0</span>], <span class="at">na.rm=</span>T)</span>
<span id="cb170-3"><a href="plotting-average-treatment-effects.html#cb170-3" aria-hidden="true" tabindex="-1"></a>t.results2 <span class="ot">&lt;-</span> <span class="fu">t.test</span>(banks<span class="sc">$</span>blackdon[banks<span class="sc">$</span>hopevcon <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb170-4"><a href="plotting-average-treatment-effects.html#cb170-4" aria-hidden="true" tabindex="-1"></a>                    banks<span class="sc">$</span>blackdon[banks<span class="sc">$</span>hopevcon <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb170-5"><a href="plotting-average-treatment-effects.html#cb170-5" aria-hidden="true" tabindex="-1"></a>ci2 <span class="ot">&lt;-</span> t.results2<span class="sc">$</span>conf.int</span></code></pre></div>
We could have alternatively used a linear regression to assess significance or randomization inference.
<details>
<summary>
Expand for a randomization inference example.
</summary>
<p>Let’s focus on just the Anger vs. Control first.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="plotting-average-treatment-effects.html#cb171-1" aria-hidden="true" tabindex="-1"></a>angercontrol <span class="ot">&lt;-</span> <span class="fu">subset</span>(banks, angvcon <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> angvcon <span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb171-2"><a href="plotting-average-treatment-effects.html#cb171-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-3"><a href="plotting-average-treatment-effects.html#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="do">## remove missing data</span></span>
<span id="cb171-4"><a href="plotting-average-treatment-effects.html#cb171-4" aria-hidden="true" tabindex="-1"></a>angercontrol <span class="ot">&lt;-</span> <span class="fu">subset</span>(angercontrol, <span class="fu">is.na</span>(blackdon) <span class="sc">==</span>F)</span>
<span id="cb171-5"><a href="plotting-average-treatment-effects.html#cb171-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-6"><a href="plotting-average-treatment-effects.html#cb171-6" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages(&quot;ri2&quot;, dependencies=T)</span></span>
<span id="cb171-7"><a href="plotting-average-treatment-effects.html#cb171-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ri2)</span>
<span id="cb171-8"><a href="plotting-average-treatment-effects.html#cb171-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-9"><a href="plotting-average-treatment-effects.html#cb171-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Declare randomization</span></span>
<span id="cb171-10"><a href="plotting-average-treatment-effects.html#cb171-10" aria-hidden="true" tabindex="-1"></a>declaration <span class="ot">&lt;-</span> <span class="fu">declare_ra</span>(<span class="at">N=</span><span class="fu">nrow</span>(angercontrol), <span class="at">prob=</span>.<span class="dv">5</span>)</span>
<span id="cb171-11"><a href="plotting-average-treatment-effects.html#cb171-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-12"><a href="plotting-average-treatment-effects.html#cb171-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Estimate the average treatment effect</span></span>
<span id="cb171-13"><a href="plotting-average-treatment-effects.html#cb171-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1215</span>)</span>
<span id="cb171-14"><a href="plotting-average-treatment-effects.html#cb171-14" aria-hidden="true" tabindex="-1"></a>ri2_out <span class="ot">&lt;-</span> <span class="fu">conduct_ri</span>(</span>
<span id="cb171-15"><a href="plotting-average-treatment-effects.html#cb171-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> blackdon <span class="sc">~</span> angvcon,</span>
<span id="cb171-16"><a href="plotting-average-treatment-effects.html#cb171-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">assignment =</span> <span class="st">&quot;angvcon&quot;</span>,</span>
<span id="cb171-17"><a href="plotting-average-treatment-effects.html#cb171-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">declaration =</span> declaration,</span>
<span id="cb171-18"><a href="plotting-average-treatment-effects.html#cb171-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">sharp_hypothesis =</span> <span class="dv">0</span>,</span>
<span id="cb171-19"><a href="plotting-average-treatment-effects.html#cb171-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> angercontrol</span>
<span id="cb171-20"><a href="plotting-average-treatment-effects.html#cb171-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot and compare distribution to observed ATE</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="plotting-average-treatment-effects.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ri2_out)</span></code></pre></div>
<p><img src="experiments_files/figure-html/unnamed-chunk-84-1.svg" width="672" /></p>
<p>Summarize Output</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="plotting-average-treatment-effects.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ri2_out)</span></code></pre></div>
<pre><code>##      term  estimate two_tailed_p_value
## 1 angvcon 0.9793778              0.041</code></pre>
<p>We can manually see what the package is doing by counting how many of the simulated estimates from the empirical distribution of the sharp null hypothesis were more extreme than our estimate from the study. Note that in this case, our p-value is very similar to the t-test.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="plotting-average-treatment-effects.html#cb175-1" aria-hidden="true" tabindex="-1"></a>estimate <span class="ot">&lt;-</span> <span class="fu">tidy</span>(ri2_out)<span class="sc">$</span>estimate</span>
<span id="cb175-2"><a href="plotting-average-treatment-effects.html#cb175-2" aria-hidden="true" tabindex="-1"></a>nsims <span class="ot">&lt;-</span> <span class="fu">length</span>(ri2_out<span class="sc">$</span>sims_df<span class="sc">$</span>est_sim)</span>
<span id="cb175-3"><a href="plotting-average-treatment-effects.html#cb175-3" aria-hidden="true" tabindex="-1"></a>simstimates <span class="ot">&lt;-</span> ri2_out<span class="sc">$</span>sims_df<span class="sc">$</span>est_sim</span>
<span id="cb175-4"><a href="plotting-average-treatment-effects.html#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Two-tailed p-value</span></span>
<span id="cb175-5"><a href="plotting-average-treatment-effects.html#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(simstimates[<span class="fu">abs</span>(simstimates) <span class="sc">&gt;=</span> <span class="fu">abs</span>(estimate)])<span class="sc">/</span>nsims</span></code></pre></div>
<pre><code>## [1] 0.041</code></pre>
<p>We can compare this to the p-value through the t-test where we assume a t distribution and calculate the area at the extremes as larger or larger than our t-statistic.</p>
<p><img src="experiments_files/figure-html/unnamed-chunk-87-1.svg" width="672" /></p>
</details>
<div id="ate-using-plot" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> ATE using <code>plot</code></h3>
<p>When we want to visualize results in R, generally we plot the main Quantity of Interest</p>
<ul>
<li>Usually the estimated average treatment effect and/or average outcome from each condition condition
<ul>
<li>With uncertainty estimates</li>
<li>Potentially also showing the distribution of underlying data</li>
</ul></li>
<li>Some marker to show a relative benchmark (e.g., a line at 0)</li>
</ul>
<p>The <code>plot</code> function in R is based on a coordinate system. We supply the <code>x=</code> and <code>y=</code> values where we want to place points.</p>
<p><img src="experiments_files/figure-html/unnamed-chunk-88-1.svg" width="672" /></p>
<p>We will make a plot to display the two ATE estimates we just calculated.</p>
<ul>
<li>We need to supply the exact same number of values for the x-axis as the y-axis. Let’s plot the ATE estimates at points 1 and 2 on the x-axis and at the corresponding y-values for the ATEs we estimated.</li>
</ul>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="plotting-average-treatment-effects.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot </span></span>
<span id="cb177-2"><a href="plotting-average-treatment-effects.html#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb177-3"><a href="plotting-average-treatment-effects.html#cb177-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="fu">c</span>(d.i.m, d.i.m2))</span></code></pre></div>
<p><img src="experiments_files/figure-html/unnamed-chunk-89-1.svg" width="672" /></p>
<p>This has created the plot, but it is not very informative.</p>
<ul>
<li>Let’ set the axis dimensions with <code>xlim=</code> an <code>ylim=</code></li>
<li>Let’s add a title with <code>main=</code>
<ul>
<li>We can adjust the size of the title text with <code>cex.main</code></li>
</ul></li>
<li>Let’s add a label for y and x axis with <code>ylab</code> and <code>xlab</code>
<ul>
<li>We can adjust the size of the labels <code>cex.lab</code></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="plotting-average-treatment-effects.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb178-2"><a href="plotting-average-treatment-effects.html#cb178-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="fu">c</span>(d.i.m, d.i.m2),</span>
<span id="cb178-3"><a href="plotting-average-treatment-effects.html#cb178-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(.<span class="dv">5</span>, <span class="fl">2.5</span>),</span>
<span id="cb178-4"><a href="plotting-average-treatment-effects.html#cb178-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb178-5"><a href="plotting-average-treatment-effects.html#cb178-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Average Treatment Effects on Donations to Black Organizations&quot;</span>,</span>
<span id="cb178-6"><a href="plotting-average-treatment-effects.html#cb178-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.main=</span>.<span class="dv">8</span>,</span>
<span id="cb178-7"><a href="plotting-average-treatment-effects.html#cb178-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Difference in Donation Amount&quot;</span>,</span>
<span id="cb178-8"><a href="plotting-average-treatment-effects.html#cb178-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span> <span class="st">&quot;Treatment Comparison&quot;</span>,</span>
<span id="cb178-9"><a href="plotting-average-treatment-effects.html#cb178-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab=</span>.<span class="dv">8</span>)</span></code></pre></div>
<p><img src="experiments_files/figure-html/unnamed-chunk-90-1.svg" width="672" /></p>
<p>In our case, the values on the x-axis are meaningless. We arbitrarily placed the points at 1 and 2. Let’s get rid of the current x-axis and instead replace it with an axis that labels our comparisons.</p>
<ul>
<li>We get rid of the current x-axis with <code>xaxt="n"</code></li>
<li>We create a new axis using the <code>axis</code> function. Note: this function goes below the <code>plot()</code> function instead of inside it.</li>
</ul>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="plotting-average-treatment-effects.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb179-2"><a href="plotting-average-treatment-effects.html#cb179-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="fu">c</span>(d.i.m, d.i.m2),</span>
<span id="cb179-3"><a href="plotting-average-treatment-effects.html#cb179-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(.<span class="dv">5</span>, <span class="fl">2.5</span>),</span>
<span id="cb179-4"><a href="plotting-average-treatment-effects.html#cb179-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb179-5"><a href="plotting-average-treatment-effects.html#cb179-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Average Treatment Effects on Donations to Black Organizations&quot;</span>,</span>
<span id="cb179-6"><a href="plotting-average-treatment-effects.html#cb179-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.main=</span>.<span class="dv">8</span>,</span>
<span id="cb179-7"><a href="plotting-average-treatment-effects.html#cb179-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Difference in Donation Amount&quot;</span>,</span>
<span id="cb179-8"><a href="plotting-average-treatment-effects.html#cb179-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span> <span class="st">&quot;Treatment Comparison&quot;</span>,</span>
<span id="cb179-9"><a href="plotting-average-treatment-effects.html#cb179-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab=</span>.<span class="dv">8</span>,</span>
<span id="cb179-10"><a href="plotting-average-treatment-effects.html#cb179-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb179-11"><a href="plotting-average-treatment-effects.html#cb179-11" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Anger vs. </span><span class="sc">\n</span><span class="st"> Control&quot;</span>,<span class="st">&quot;Hope vs. </span><span class="sc">\n</span><span class="st"> Control&quot;</span>),</span>
<span id="cb179-12"><a href="plotting-average-treatment-effects.html#cb179-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">tick=</span>F)</span></code></pre></div>
<p><img src="experiments_files/figure-html/unnamed-chunk-91-1.svg" width="672" /></p>
<p>We now have an informative plot of our ATE quantities of interest. However, we still need to add something to visualize uncertainty and a benchmark to indicate the size and/or significance of our quantities.</p>
<ul>
<li>We can add a horizonatal line to the plot with <code>abline(h=)</code>. Like <code>axis()</code>, this function goes below the <code>plot()</code> function.</li>
<li>We can add confidence intervals as vertical line segments to our plot using the <code>lines</code> function. Again, this adds a layer below our plot.</li>
</ul>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="plotting-average-treatment-effects.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb180-2"><a href="plotting-average-treatment-effects.html#cb180-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="fu">c</span>(d.i.m, d.i.m2),</span>
<span id="cb180-3"><a href="plotting-average-treatment-effects.html#cb180-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(.<span class="dv">5</span>, <span class="fl">2.5</span>),</span>
<span id="cb180-4"><a href="plotting-average-treatment-effects.html#cb180-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb180-5"><a href="plotting-average-treatment-effects.html#cb180-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Average Treatment Effects on Donations to Black Organizations&quot;</span>,</span>
<span id="cb180-6"><a href="plotting-average-treatment-effects.html#cb180-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.main=</span>.<span class="dv">8</span>,</span>
<span id="cb180-7"><a href="plotting-average-treatment-effects.html#cb180-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Difference in Donation Amount&quot;</span>,</span>
<span id="cb180-8"><a href="plotting-average-treatment-effects.html#cb180-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span> <span class="st">&quot;Treatment Comparison&quot;</span>,</span>
<span id="cb180-9"><a href="plotting-average-treatment-effects.html#cb180-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab=</span>.<span class="dv">8</span>,</span>
<span id="cb180-10"><a href="plotting-average-treatment-effects.html#cb180-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb180-11"><a href="plotting-average-treatment-effects.html#cb180-11" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Anger vs. </span><span class="sc">\n</span><span class="st"> Control&quot;</span>,<span class="st">&quot;Hope vs. </span><span class="sc">\n</span><span class="st"> Control&quot;</span>),</span>
<span id="cb180-12"><a href="plotting-average-treatment-effects.html#cb180-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">tick=</span>F)</span>
<span id="cb180-13"><a href="plotting-average-treatment-effects.html#cb180-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">&quot;red3&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb180-14"><a href="plotting-average-treatment-effects.html#cb180-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), ci)</span>
<span id="cb180-15"><a href="plotting-average-treatment-effects.html#cb180-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), ci2)</span></code></pre></div>
<p><img src="experiments_files/figure-html/unnamed-chunk-92-1.svg" width="672" /></p>
</div>
<div id="ate-with-ggplot" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> ATE with <code>ggplot</code></h3>
<p>The package <code>ggplot2</code> also offers a system of plotting in R. The “gg” in ggplot2 stands for the “Grammar of Graphics.” This program provides another framework for creating figures in R. According to Hadley Wickham, “ggplot2 provides beautiful, hassle-free plots that take care of fiddly details like drawing legends.”</p>
<p>Practically speaking, <code>ggplot()</code> is another tool to plot the same types of figures we have been making in class. Some people prefer <code>ggplot2</code> because they find the logic of building figures more intuitive using this framework and/or more aesthetically pleasing. However, both <code>ggplot()</code> and the plots we have been making in class can accomplish the same ultimate goals of data visualization– to communicate information transparently, quickly, accurately, simply, and beautifully. Which types of plots you may prefer is up to your own taste.</p>
<p>The syntax for this is different. One of the primary differences is that the <code>ggplot</code> function generally requires that you start from a <code>data.frame</code> object. This means that we will have to organize the set of results we want to plot into a rectangular data.frame.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="plotting-average-treatment-effects.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Put each result in a vector</span></span>
<span id="cb181-2"><a href="plotting-average-treatment-effects.html#cb181-2" aria-hidden="true" tabindex="-1"></a>angerresults <span class="ot">&lt;-</span> <span class="fu">c</span>(d.i.m, ci)</span>
<span id="cb181-3"><a href="plotting-average-treatment-effects.html#cb181-3" aria-hidden="true" tabindex="-1"></a>hoperesults <span class="ot">&lt;-</span> <span class="fu">c</span>(d.i.m2, ci2)</span>
<span id="cb181-4"><a href="plotting-average-treatment-effects.html#cb181-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-5"><a href="plotting-average-treatment-effects.html#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Bind these together as rows, store as dataframe</span></span>
<span id="cb181-6"><a href="plotting-average-treatment-effects.html#cb181-6" aria-hidden="true" tabindex="-1"></a>comb <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rbind</span>(angerresults, hoperesults))</span>
<span id="cb181-7"><a href="plotting-average-treatment-effects.html#cb181-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-8"><a href="plotting-average-treatment-effects.html#cb181-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Give columns informative labels</span></span>
<span id="cb181-9"><a href="plotting-average-treatment-effects.html#cb181-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(comb) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ATE&quot;</span>, <span class="st">&quot;lower&quot;</span>, <span class="st">&quot;upper&quot;</span>)</span>
<span id="cb181-10"><a href="plotting-average-treatment-effects.html#cb181-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-11"><a href="plotting-average-treatment-effects.html#cb181-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Add group indicator</span></span>
<span id="cb181-12"><a href="plotting-average-treatment-effects.html#cb181-12" aria-hidden="true" tabindex="-1"></a>comb<span class="sc">$</span>Comparison <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Anger vs. </span><span class="sc">\n</span><span class="st"> Control&quot;</span>,<span class="st">&quot;Hope vs. </span><span class="sc">\n</span><span class="st"> Control&quot;</span>)</span></code></pre></div>
<p>Now we can use the <code>ggplot</code> function from the <code>ggplot2</code> package. The main plotting function in <code>ggplot2</code> is the <code>ggplot()</code> function. It will give you access to barplots, boxplots, scatterplots, histograms, etc.</p>
<p>The three primary components of a ggplot() are a dataframe (<code>data =</code>), a set of mapping aesthetics (<code>aes()</code>), and <code>geoms</code> (e.g., geom boxplot, geom bar, geom point, geom line, etc.).</p>
<ul>
<li>The function <code>ggplot()</code> first takes a dataframe that includes the values you would like to plot (e.g., <code>data = comb</code>).</li>
<li>The aesthetics then include the variable names that you want to plot on the x and y axis (e.g., <code>aes(x=Comparison, y=ATE)</code>)
<ul>
<li>Additional mapping aesthetics can be specified. For example, a third variable (or a repeat of a previous variable) can also be specified (e.g., <code>fill =</code>, <code>colour =</code>, <code>shape =</code>), which acts as a grouping variable. If this is specified, <code>ggplot()</code> will create a corresponding legend for the plot and will color/make different shapes for different groups within this third variable.</li>
</ul></li>
<li>After closing out the first <code>ggplot()</code> parentheses, you then annotate the plot by adding (<code>+</code>) a geometric layer.
<ul>
<li>In the example below, we use the <code>geom_point</code> layer to add the ATEs and <code>geom_errorbar</code> layer to add confidence intervals.</li>
</ul></li>
</ul>
<p>There are many more possibilities for plotting with <code>ggplot()</code>. For additional resources on all that is gg, I recommend the <a href="https://%20r-graphics.org/">R Graphics Cookbook</a>.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="plotting-average-treatment-effects.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb182-2"><a href="plotting-average-treatment-effects.html#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comb, <span class="fu">aes</span>(<span class="at">x=</span>Comparison, <span class="at">y=</span>ATE))<span class="sc">+</span></span>
<span id="cb182-3"><a href="plotting-average-treatment-effects.html#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb182-4"><a href="plotting-average-treatment-effects.html#cb182-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper), <span class="at">width=</span>.<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb182-5"><a href="plotting-average-treatment-effects.html#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="experiments_files/figure-html/unnamed-chunk-94-1.svg" width="672" /></p>
<p>Just like with the other plotting functions in R, you can also specify a number of other arguments to make your plot more informative and aesthetically pleasing. Here, you do this by adding (<code>+</code>) additional arguments. See examples below (e.g., <code>ggtitle</code>, <code>xlab</code>, <code>ylab</code> for titles, <code>ylim</code> for y-axis limits, etc.). We can also add a horizontal line with <code>geom_hline</code>.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="plotting-average-treatment-effects.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comb, <span class="fu">aes</span>(<span class="at">x=</span>Comparison, <span class="at">y=</span>ATE))<span class="sc">+</span></span>
<span id="cb183-2"><a href="plotting-average-treatment-effects.html#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb183-3"><a href="plotting-average-treatment-effects.html#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper), <span class="at">width=</span>.<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb183-4"><a href="plotting-average-treatment-effects.html#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb183-5"><a href="plotting-average-treatment-effects.html#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept=</span><span class="dv">0</span>), <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="at">colour=</span><span class="st">&quot;red3&quot;</span>)<span class="sc">+</span></span>
<span id="cb183-6"><a href="plotting-average-treatment-effects.html#cb183-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Average Treatment Effects on Donations to Black Organizations&quot;</span>)<span class="sc">+</span></span>
<span id="cb183-7"><a href="plotting-average-treatment-effects.html#cb183-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))<span class="co"># centers title</span></span></code></pre></div>
<p><img src="experiments_files/figure-html/unnamed-chunk-95-1.svg" width="672" /></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualize.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="heterogeneous-treatment-effects-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
